.. _test_add_follower_round_2_timeout_1:

======================================================================
Test test_add_follower_round_2_timeout_1 from file test_member_changes
======================================================================


    This is a complicated one. It tests that the leader will timeout while trying to load
    a new node's log prior to adding it to the cluster. Specifically, that it will timeout
    when one election_timeout_max period has passed since the beginning of a loading round
    that is not the first round.

    First an normal election is run with three nodes. Next the node a loaded with a few log
    records, but we cheat and do it directly rather than running the commands for real. This
    reduces the logger output to help with debugging, and it reduces the tracing output.
    Not really necessisary, but nice.

    Next, a new test server is created but not started yet. It has an event handler registered
    for membership change events. The new server gets a call to the start_and_join method of the deck,
    which starts the process of adding the server to the cluster. It sends a message to the leader
    asking to be added, then the leader starts loading it with log records prior to starting the actual
    add.

    We set up pause triggers to capture the moment when the leader sends the append entries message
    that contains the last log entry and pause the leader there, allow the new node to process
    it but not yet send the response.

    If the response message was allowed to proceed, this would be the moment that
    the cluster_ops code would recognized both that the first round of loading is complete, and that
    there are no new log records to send. We want it instead to see new log records and start
    a second round of loading.

    So at this point we use our trick of loading new log records into the log directly. Just one record,
    loaded at nodes 1, 2 and 3.

    Now we disable the network on the new node so that it will not receive the next append entries.

    We let the paused pending entries response proceed, so that the cluster_ops code starts a new
    round of loading and starts a timeout function that will detect if the round takes longer than
    election_timeout_max to complete. Since we are not allowing the new node to receive messages,
    this timeout will fire and cause the add node abort sequence to run.

    The leader will reset all the internal state that it maintains for loading a node before
    add to the cluster, and it will send a response to the original memebership change message
    indicating that it failed.

    When node 4 receives this message, it will call our callback and issue our expected event,
    in both cases indicating failure, which we check.

    At this point everyone has forgotten that the add has been attempted, so another attempt
    is possbile.

    So, we call stop on the new node, call the start_and_join method again and enable the network.
    The leader should start a new loading operation, which should succeed, then notify all the
    followers (not the new node) that they should add the new node, then once it gets commit
    concurrence it will complete the add operation and send a membership change response to node 4
    which will trigger our callback and event handler.

    As a result of the add completion, the leader will update its commit index and the other
    servers need to know about it in order to send make the membership change permanent. So
    we trigger it to send a heartbeat, and then check all the followers to ensure the
    cluster state is correct..

    Simple!
    
    

Section 1: Normal election
==========================




.. collapse:: section 1 trace table (click to toggle view)

   - See :ref:`Trace Table Legend` for help interpreting table contents

   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | N-1  | N-1                         | N-1       | N-2  | N-2                         | N-2       | N-3  | N-3                         | N-3       | N-4  | N-4 | N-4   |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | Role | Op                          | Delta     | Role | Op                          | Delta     | Role | Op                          | Delta     | Role | Op  | Delta |
   +======+=============================+===========+======+=============================+===========+======+=============================+===========+======+=====+=======+
   | CNDI | NEW ROLE                    |           | FLWR |                             |           | FLWR |                             |           |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | CNDI | poll+N-2 t-1 li-0 lt-1      |           | FLWR |                             |           | FLWR |                             |           |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | CNDI | poll+N-3 t-1 li-0 lt-1      |           | FLWR |                             |           | FLWR |                             |           |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | CNDI |                             |           | FLWR | N-1+poll t-1 li-0 lt-1      | t-1       | FLWR |                             |           |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | CNDI |                             |           | FLWR | vote+N-1 yes-True           |           | FLWR |                             |           |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | CNDI |                             |           | FLWR |                             |           | FLWR | N-1+poll t-1 li-0 lt-1      | t-1       |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | CNDI |                             |           | FLWR |                             |           | FLWR | vote+N-1 yes-True           |           |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | LEAD | N-2+vote yes-True           | lt-1 li-1 | FLWR |                             |           | FLWR |                             |           |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | LEAD | NEW ROLE                    |           | FLWR |                             |           | FLWR |                             |           |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | LEAD | ae+N-2 t-1 i-0 lt-0 e-1 c-0 |           | FLWR |                             |           | FLWR |                             |           |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | LEAD | ae+N-3 t-1 i-0 lt-0 e-1 c-0 |           | FLWR |                             |           | FLWR |                             |           |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | LEAD | N-3+vote yes-True           |           | FLWR |                             |           | FLWR |                             |           |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | LEAD |                             |           | FLWR | N-1+ae t-1 i-0 lt-0 e-1 c-0 | lt-1 li-1 | FLWR |                             |           |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | LEAD |                             |           | FLWR | N-2+ae_reply ok-True mi-1   |           | FLWR |                             |           |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | LEAD |                             |           | FLWR |                             |           | FLWR | N-1+ae t-1 i-0 lt-0 e-1 c-0 | lt-1 li-1 |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | LEAD |                             |           | FLWR |                             |           | FLWR | N-3+ae_reply ok-True mi-1   |           |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | LEAD | N-2+ae_reply ok-True mi-1   | ci-1      | FLWR |                             |           | FLWR |                             |           |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+
   | LEAD | N-3+ae_reply ok-True mi-1   |           | FLWR |                             |           | FLWR |                             |           |      |     |       |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----+-------+



.. collapse:: trace sequence diagram (click to toggle view)

   .. plantuml:: /developer/tests/diagrams/test_member_changes/test_add_follower_round_2_timeout_1_1.puml
          :scale: 100%


Section 2: Node 1 is leader, cheat loading 6 log records
========================================================




.. collapse:: section 2 trace table (click to toggle view)

   - See :ref:`Trace Table Legend` for help interpreting table contents

   +------+-----+-------+------+-----+-------+------+-----+-------+------+-----+-------+
   | N-1  | N-1 | N-1   | N-2  | N-2 | N-2   | N-3  | N-3 | N-3   | N-4  | N-4 | N-4   |
   +------+-----+-------+------+-----+-------+------+-----+-------+------+-----+-------+
   | Role | Op  | Delta | Role | Op  | Delta | Role | Op  | Delta | Role | Op  | Delta |
   +------+-----+-------+------+-----+-------+------+-----+-------+------+-----+-------+



.. collapse:: trace sequence diagram (click to toggle view)

   .. plantuml:: /developer/tests/diagrams/test_member_changes/test_add_follower_round_2_timeout_1_2.puml
          :scale: 100%


Section 3: Node 4 created, telling it to start_and_join, waiting for append entries sequences
=============================================================================================




.. collapse:: section 3 trace table (click to toggle view)

   - See :ref:`Trace Table Legend` for help interpreting table contents

   +------+-----------------------------+-------+------+-----+-------+------+-----+-------+------+-----------------------------+----------------+
   | N-1  | N-1                         | N-1   | N-2  | N-2 | N-2   | N-3  | N-3 | N-3   | N-4  | N-4                         | N-4            |
   +------+-----------------------------+-------+------+-----+-------+------+-----+-------+------+-----------------------------+----------------+
   | Role | Op                          | Delta | Role | Op  | Delta | Role | Op  | Delta | Role | Op                          | Delta          |
   +======+=============================+=======+======+=====+=======+======+=====+=======+======+=============================+================+
   | LEAD |                             |       | FLWR |     |       | FLWR |     |       | FLWR | m_c+N-1 op-ADD n-mcpy://4   |                |
   +------+-----------------------------+-------+------+-----+-------+------+-----+-------+------+-----------------------------+----------------+
   | LEAD | N-4+m_c op-ADD n-mcpy://4   |       | FLWR |     |       | FLWR |     |       | FLWR |                             |                |
   +------+-----------------------------+-------+------+-----+-------+------+-----+-------+------+-----------------------------+----------------+
   | LEAD | ae+N-4 t-1 i-7 lt-1 e-0 c-7 |       | FLWR |     |       | FLWR |     |       | FLWR |                             |                |
   +------+-----------------------------+-------+------+-----+-------+------+-----+-------+------+-----------------------------+----------------+
   | LEAD |                             |       | FLWR |     |       | FLWR |     |       | FLWR | N-1+ae t-1 i-7 lt-1 e-0 c-7 | t-1            |
   +------+-----------------------------+-------+------+-----+-------+------+-----+-------+------+-----------------------------+----------------+
   | LEAD | N-4+ae_reply ok-False mi-0  |       | FLWR |     |       | FLWR |     |       | FLWR |                             |                |
   +------+-----------------------------+-------+------+-----+-------+------+-----+-------+------+-----------------------------+----------------+
   | LEAD | ae+N-4 t-1 i-0 lt-0 e-1 c-7 |       | FLWR |     |       | FLWR |     |       | FLWR |                             |                |
   +------+-----------------------------+-------+------+-----+-------+------+-----+-------+------+-----------------------------+----------------+
   | LEAD |                             |       | FLWR |     |       | FLWR |     |       | FLWR | N-1+ae t-1 i-0 lt-0 e-1 c-7 | lt-1 li-1 ci-1 |
   +------+-----------------------------+-------+------+-----+-------+------+-----+-------+------+-----------------------------+----------------+
   | LEAD |                             |       | FLWR |     |       | FLWR |     |       | FLWR | N-4+ae_reply ok-True mi-1   |                |
   +------+-----------------------------+-------+------+-----+-------+------+-----+-------+------+-----------------------------+----------------+
   | LEAD | N-4+ae_reply ok-True mi-1   |       | FLWR |     |       | FLWR |     |       | FLWR |                             |                |
   +------+-----------------------------+-------+------+-----+-------+------+-----+-------+------+-----------------------------+----------------+
   | LEAD | ae+N-4 t-1 i-1 lt-1 e-6 c-7 |       | FLWR |     |       | FLWR |     |       | FLWR |                             |                |
   +------+-----------------------------+-------+------+-----+-------+------+-----+-------+------+-----------------------------+----------------+
   | LEAD |                             |       | FLWR |     |       | FLWR |     |       | FLWR | N-1+ae t-1 i-1 lt-1 e-6 c-7 | li-7 ci-7      |
   +------+-----------------------------+-------+------+-----+-------+------+-----+-------+------+-----------------------------+----------------+
   | LEAD |                             |       | FLWR |     |       | FLWR |     |       | FLWR | N-4+ae_reply ok-True mi-7   |                |
   +------+-----------------------------+-------+------+-----+-------+------+-----+-------+------+-----------------------------+----------------+



.. collapse:: trace sequence diagram (click to toggle view)

   .. plantuml:: /developer/tests/diagrams/test_member_changes/test_add_follower_round_2_timeout_1_3.puml
          :scale: 100%


Section 4: Node 4 has caught up its log, but last append response is paused before delivery to leader, adding log record
========================================================================================================================




.. collapse:: section 4 trace table (click to toggle view)

   - See :ref:`Trace Table Legend` for help interpreting table contents

   +------+-----+-------+------+-----+-------+------+-----+-------+------+-----+-------+
   | N-1  | N-1 | N-1   | N-2  | N-2 | N-2   | N-3  | N-3 | N-3   | N-4  | N-4 | N-4   |
   +------+-----+-------+------+-----+-------+------+-----+-------+------+-----+-------+
   | Role | Op  | Delta | Role | Op  | Delta | Role | Op  | Delta | Role | Op  | Delta |
   +------+-----+-------+------+-----+-------+------+-----+-------+------+-----+-------+



.. collapse:: trace sequence diagram (click to toggle view)

   .. plantuml:: /developer/tests/diagrams/test_member_changes/test_add_follower_round_2_timeout_1_4.puml
          :scale: 100%


Section 5: Blocking comms at node 4, running network ops and Waiting for leader to timeout and notify node 4
============================================================================================================




.. collapse:: section 5 trace table (click to toggle view)

   - See :ref:`Trace Table Legend` for help interpreting table contents

   +------+-------------------------------------+-------+------+-----+-------+------+-----+-------+------+-------------------------------------+-------+
   | N-1  | N-1                                 | N-1   | N-2  | N-2 | N-2   | N-3  | N-3 | N-3   | N-4  | N-4                                 | N-4   |
   +------+-------------------------------------+-------+------+-----+-------+------+-----+-------+------+-------------------------------------+-------+
   | Role | Op                                  | Delta | Role | Op  | Delta | Role | Op  | Delta | Role | Op                                  | Delta |
   +======+=====================================+=======+======+=====+=======+======+=====+=======+======+=====================================+=======+
   | LEAD | N-4+ae_reply ok-True mi-7           |       | FLWR |     |       | FLWR |     |       | FLWR |                                     |       |
   +------+-------------------------------------+-------+------+-----+-------+------+-----+-------+------+-------------------------------------+-------+
   | LEAD | ae+N-4 t-1 i-7 lt-1 e-1 c-8         |       | FLWR |     |       | FLWR |     |       | FLWR |                                     |       |
   +------+-------------------------------------+-------+------+-----+-------+------+-----+-------+------+-------------------------------------+-------+
   | LEAD | m_cr+N-4 op-ADD n-mcpy://4 ok-False |       | FLWR |     |       | FLWR |     |       | FLWR |                                     |       |
   +------+-------------------------------------+-------+------+-----+-------+------+-----+-------+------+-------------------------------------+-------+
   | LEAD |                                     |       | FLWR |     |       | FLWR |     |       | FLWR | N-1+m_cr op-ADD n-mcpy://4 ok-False |       |
   +------+-------------------------------------+-------+------+-----+-------+------+-----+-------+------+-------------------------------------+-------+



.. collapse:: trace sequence diagram (click to toggle view)

   .. plantuml:: /developer/tests/diagrams/test_member_changes/test_add_follower_round_2_timeout_1_5.puml
          :scale: 100%


Section 6: Node 4 callback and handler results correct and cluster node list state correct, restarting add with all normal
==========================================================================================================================




.. collapse:: section 6 trace table (click to toggle view)

   - See :ref:`Trace Table Legend` for help interpreting table contents

   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | N-1  | N-1                                | N-1   | N-2  | N-2                         | N-2       | N-3  | N-3                         | N-3       | N-4  | N-4                                | N-4       |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | Role | Op                                 | Delta | Role | Op                          | Delta     | Role | Op                          | Delta     | Role | Op                                 | Delta     |
   +======+====================================+=======+======+=============================+===========+======+=============================+===========+======+====================================+===========+
   | LEAD |                                    |       | FLWR |                             |           | FLWR |                             |           | FLWR | m_c+N-1 op-ADD n-mcpy://4          |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | N-4+m_c op-ADD n-mcpy://4          |       | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | ae+N-4 t-1 i-8 lt-1 e-0 c-8        |       | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD |                                    |       | FLWR |                             |           | FLWR |                             |           | FLWR | N-1+ae t-1 i-8 lt-1 e-0 c-8        |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD |                                    |       | FLWR |                             |           | FLWR |                             |           | FLWR | N-4+ae_reply ok-False mi-7         |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | N-4+ae_reply ok-False mi-7         |       | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | ae+N-4 t-1 i-7 lt-1 e-1 c-8        |       | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD |                                    |       | FLWR |                             |           | FLWR |                             |           | FLWR | N-1+ae t-1 i-7 lt-1 e-1 c-8        | li-8 ci-8 |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD |                                    |       | FLWR |                             |           | FLWR |                             |           | FLWR | N-4+ae_reply ok-True mi-8          |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | N-4+ae_reply ok-True mi-8          | li-9  | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | m_cr+N-4 op-ADD n-mcpy://4 ok-True |       | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD |                                    |       | FLWR |                             |           | FLWR |                             |           | FLWR | N-1+m_cr op-ADD n-mcpy://4 ok-True |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | ae+N-4 t-1 i-8 lt-1 e-1 c-8        |       | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD |                                    |       | FLWR |                             |           | FLWR |                             |           | FLWR | N-1+ae t-1 i-8 lt-1 e-1 c-8        | li-9      |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD |                                    |       | FLWR |                             |           | FLWR |                             |           | FLWR | N-4+ae_reply ok-True mi-9          |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | N-4+ae_reply ok-True mi-9          | ci-9  | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | ae+N-2 t-1 i-9 lt-1 e-0 c-9        |       | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD |                                    |       | FLWR | N-1+ae t-1 i-9 lt-1 e-0 c-9 |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD |                                    |       | FLWR | N-2+ae_reply ok-False mi-8  |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | N-2+ae_reply ok-False mi-8         |       | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | ae+N-3 t-1 i-9 lt-1 e-0 c-9        |       | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD |                                    |       | FLWR |                             |           | FLWR | N-1+ae t-1 i-9 lt-1 e-0 c-9 |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD |                                    |       | FLWR |                             |           | FLWR | N-3+ae_reply ok-False mi-8  |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | N-3+ae_reply ok-False mi-8         |       | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | ae+N-4 t-1 i-9 lt-1 e-0 c-9        |       | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD |                                    |       | FLWR |                             |           | FLWR |                             |           | FLWR | N-1+ae t-1 i-9 lt-1 e-0 c-9        | ci-9      |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD |                                    |       | FLWR |                             |           | FLWR |                             |           | FLWR | N-4+ae_reply ok-True mi-9          |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | N-4+ae_reply ok-True mi-9          |       | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | ae+N-2 t-1 i-8 lt-1 e-1 c-9        |       | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD |                                    |       | FLWR | N-1+ae t-1 i-8 lt-1 e-1 c-9 | li-9 ci-9 | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD |                                    |       | FLWR | N-2+ae_reply ok-True mi-9   |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | N-2+ae_reply ok-True mi-9          |       | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | ae+N-3 t-1 i-8 lt-1 e-1 c-9        |       | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD |                                    |       | FLWR |                             |           | FLWR | N-1+ae t-1 i-8 lt-1 e-1 c-9 | li-9 ci-9 | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD |                                    |       | FLWR |                             |           | FLWR | N-3+ae_reply ok-True mi-9   |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+
   | LEAD | N-3+ae_reply ok-True mi-9          |       | FLWR |                             |           | FLWR |                             |           | FLWR |                                    |           |
   +------+------------------------------------+-------+------+-----------------------------+-----------+------+-----------------------------+-----------+------+------------------------------------+-----------+



.. collapse:: trace sequence diagram (click to toggle view)

   .. plantuml:: /developer/tests/diagrams/test_member_changes/test_add_follower_round_2_timeout_1_6.puml
          :scale: 100%


