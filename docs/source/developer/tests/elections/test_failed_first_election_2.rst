.. _test_failed_first_election_2:

============================================================
Test test_failed_first_election_2 from file test_elections_2
============================================================


    Let a leader win, but before the followers get his term_start log message, make him crash.
    Have a new election, then re-start the ex leader. His log will have one record in it, and so will the 
    new leader's, but the terms will be different. This hits a special case in follower code.

    This test runs with pre_vote enabled. test_failed_first_election_1 is identical
    except that it runs with prev_vote enabled.o
    
    Timers are disabled, so all timer driven operations such as heartbeats are manually triggered.
    

Section 1: Command triggering node three to start election
==========================================================




.. collapse:: section 1 trace table (click to toggle view)

   - See :ref:`Trace Table Legend` for help interpreting table contents

   +------+-------------------------+-------+------+-------------------------+-------+------+-------------------------+-------+
   | N-1  | N-1                     | N-1   | N-2  | N-2                     | N-2   | N-3  | N-3                     | N-3   |
   +------+-------------------------+-------+------+-------------------------+-------+------+-------------------------+-------+
   | Role | Op                      | Delta | Role | Op                      | Delta | Role | Op                      | Delta |
   +======+=========================+=======+======+=========================+=======+======+=========================+=======+
   | FLWR |                         |       | FLWR |                         |       | CNDI | NEW ROLE                |       |
   +------+-------------------------+-------+------+-------------------------+-------+------+-------------------------+-------+
   | FLWR |                         |       | FLWR |                         |       | CNDI | p_v_r+N-1 t-1 li-0 lt-0 |       |
   +------+-------------------------+-------+------+-------------------------+-------+------+-------------------------+-------+
   | FLWR |                         |       | FLWR |                         |       | CNDI | p_v_r+N-2 t-1 li-0 lt-0 |       |
   +------+-------------------------+-------+------+-------------------------+-------+------+-------------------------+-------+
   | FLWR | N-3+p_v_r t-1 li-0 lt-0 |       | FLWR |                         |       | CNDI |                         |       |
   +------+-------------------------+-------+------+-------------------------+-------+------+-------------------------+-------+
   | FLWR |                         |       | FLWR | N-3+p_v_r t-1 li-0 lt-0 |       | CNDI |                         |       |
   +------+-------------------------+-------+------+-------------------------+-------+------+-------------------------+-------+
   | FLWR |                         |       | FLWR |                         |       | CNDI | N-1+p_v yes-True        | t-1   |
   +------+-------------------------+-------+------+-------------------------+-------+------+-------------------------+-------+



.. collapse:: trace sequence diagram (click to toggle view)

   .. plantuml:: /developer/tests/diagrams/test_elections_2/test_failed_first_election_2_1.puml
          :scale: 100%


Section 2: Candidate requested votes
====================================




.. collapse:: section 2 trace table (click to toggle view)

   - See :ref:`Trace Table Legend` for help interpreting table contents

   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | N-1  | N-1                         | N-1       | N-2  | N-2                         | N-2       | N-3  | N-3                         | N-3           |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | Role | Op                          | Delta     | Role | Op                          | Delta     | Role | Op                          | Delta         |
   +======+=============================+===========+======+=============================+===========+======+=============================+===============+
   | FLWR |                             |           | FLWR |                             |           | CNDI | poll+N-1 t-1 li-0 lt-1      |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | FLWR |                             |           | FLWR |                             |           | CNDI | poll+N-2 t-1 li-0 lt-1      |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | FLWR | N-3+poll t-1 li-0 lt-1      | t-1       | FLWR |                             |           | CNDI |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | FLWR |                             |           | FLWR | N-3+poll t-1 li-0 lt-1      | t-1       | CNDI |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | FLWR |                             |           | FLWR |                             |           | CNDI | N-2+p_v yes-True            |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | FLWR |                             |           | FLWR |                             |           | LEAD | N-1+vote yes-True           | lt-1 li-1     |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | FLWR |                             |           | FLWR |                             |           | LEAD | NEW ROLE                    |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | FLWR |                             |           | FLWR |                             |           | LEAD | CRASH                       |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | CNDI | NEW ROLE                    |           | FLWR |                             |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | CNDI | p_v_r+N-2 t-2 li-0 lt-1     |           | FLWR |                             |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | CNDI | p_v_r+N-3 t-2 li-0 lt-1     |           | FLWR |                             |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | CNDI |                             |           | FLWR | N-1+p_v_r t-2 li-0 lt-1     |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | CNDI |                             |           | FLWR | p_v+N-1 yes-True            |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | CNDI | N-2+p_v yes-True            | t-2       | FLWR |                             |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | CNDI | poll+N-2 t-2 li-0 lt-2      |           | FLWR |                             |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | CNDI | poll+N-3 t-2 li-0 lt-2      |           | FLWR |                             |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | CNDI |                             |           | FLWR | N-1+poll t-2 li-0 lt-2      | t-2       | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | CNDI |                             |           | FLWR | vote+N-1 yes-True           |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD | N-2+vote yes-True           | lt-2 li-1 | FLWR |                             |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD | NEW ROLE                    |           | FLWR |                             |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD | ae+N-2 t-2 i-0 lt-0 e-1 c-0 |           | FLWR |                             |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD | ae+N-3 t-2 i-0 lt-0 e-1 c-0 |           | FLWR |                             |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD |                             |           | FLWR | N-1+ae t-2 i-0 lt-0 e-1 c-0 | lt-2 li-1 | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD |                             |           | FLWR | N-2+ae_reply ok-True mi-1   |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD | N-2+ae_reply ok-True mi-1   | ci-1      | FLWR |                             |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD |                             |           | FLWR |                             |           | FLWR | RESTART                     |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD | ae+N-2 t-2 i-1 lt-2 e-0 c-1 |           | FLWR |                             |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD |                             |           | FLWR | N-1+ae t-2 i-1 lt-2 e-0 c-1 | ci-1      | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD |                             |           | FLWR | N-2+ae_reply ok-True mi-1   |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD | N-2+ae_reply ok-True mi-1   |           | FLWR |                             |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD | ae+N-3 t-2 i-1 lt-2 e-0 c-1 |           | FLWR |                             |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD |                             |           | FLWR |                             |           | FLWR | N-1+ae t-2 i-1 lt-2 e-0 c-1 | t-2           |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD |                             |           | FLWR |                             |           | FLWR | N-3+ae_reply ok-False mi-1  |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD | N-3+ae_reply ok-False mi-1  |           | FLWR |                             |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD | ae+N-3 t-2 i-0 lt-0 e-1 c-1 |           | FLWR |                             |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD |                             |           | FLWR |                             |           | FLWR | N-1+ae t-2 i-0 lt-0 e-1 c-1 | t-0 lt-2 ci-1 |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD |                             |           | FLWR |                             |           | FLWR | N-3+ae_reply ok-True mi-1   |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+
   | LEAD | N-3+ae_reply ok-True mi-1   |           | FLWR |                             |           | FLWR |                             |               |
   +------+-----------------------------+-----------+------+-----------------------------+-----------+------+-----------------------------+---------------+



.. collapse:: trace sequence diagram (click to toggle view)

   .. plantuml:: /developer/tests/diagrams/test_elections_2/test_failed_first_election_2_2.puml
          :scale: 100%


