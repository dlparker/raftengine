@startuml
!pragma ratio 0.7
skinparam dpi 150
skinparam monochrome false
skinparam sequence {
  ArrowColor Black
  ActorBorderColor Black
  LifeLineBorderColor Black
  ParticipantFontSize 12
  Padding 10
}
skinparam legend {
  BackgroundColor #F5F5F5
  FontSize 11
}
title Raft Consensus Sequence (test_snapshot_4 Section 2)

participant "Node 1" as n1 order 10 #Lightgreen
participant "Node 2" as n2 order 20 #Lightgreen
participant "Node 3" as n3 order 30 #Lightgreen
n1 -> n2: AppendEntries(term=1, prevIndex=1, prevTerm=1, 1 entry, commitIndex=1)
note left of n1: Log: index=2, term=0
n1 -> n3: AppendEntries(term=1, prevIndex=1, prevTerm=1, 1 entry, commitIndex=1)
note right of n2: Log: index=2, term=0
n2 -> n1: AppendResponse(success=True, maxIndex=2)
note right of n3: Log: index=2, term=0
n3 -> n1: AppendResponse(success=True, maxIndex=2)
note left of n1: Commit: index=2
note right of n2: Commit: index=2
note right of n3: Commit: index=2
n1 -> n2: AppendEntries(term=1, prevIndex=2, prevTerm=1, 1 entry, commitIndex=2)
note left of n1: Log: index=3, term=0
n1 -> n3: AppendEntries(term=1, prevIndex=2, prevTerm=1, 1 entry, commitIndex=2)
n2 -> n1: AppendResponse(success=True, maxIndex=2)
note right of n2: Log: index=3, term=0
n2 -> n1: AppendResponse(success=True, maxIndex=3)
n3 -> n1: AppendResponse(success=True, maxIndex=2)
note right of n3: Log: index=3, term=0
n3 -> n1: AppendResponse(success=True, maxIndex=3)
n1 -> n2: AppendEntries(term=1, prevIndex=2, prevTerm=1, 1 entry, commitIndex=2)
note left of n1: Commit: index=3
n1 -> n3: AppendEntries(term=1, prevIndex=2, prevTerm=1, 1 entry, commitIndex=3)
n2 -> n1: AppendResponse(success=True, maxIndex=3)
n3 -> n1: AppendResponse(success=True, maxIndex=3)
note right of n2: Commit: index=3
note right of n3: Commit: index=3
n1 -> n2: AppendEntries(term=1, prevIndex=3, prevTerm=1, 1 entry, commitIndex=3)
note left of n1: Log: index=4, term=0
n1 -> n3: AppendEntries(term=1, prevIndex=3, prevTerm=1, 1 entry, commitIndex=3)
n1 -> n2: AppendEntries(term=1, prevIndex=3, prevTerm=1, 1 entry, commitIndex=3)
n1 -> n3: AppendEntries(term=1, prevIndex=3, prevTerm=1, 1 entry, commitIndex=3)
n2 -> n1: AppendResponse(success=True, maxIndex=3)
note right of n2: Log: index=4, term=0
n2 -> n1: AppendResponse(success=True, maxIndex=4)
n2 -> n1: AppendResponse(success=True, maxIndex=4)
n3 -> n1: AppendResponse(success=True, maxIndex=3)
note right of n3: Log: index=4, term=0
n3 -> n1: AppendResponse(success=True, maxIndex=4)
n3 -> n1: AppendResponse(success=True, maxIndex=4)
n1 -> n2: AppendEntries(term=1, prevIndex=3, prevTerm=1, 1 entry, commitIndex=3)
note left of n1: Commit: index=4
n1 -> n3: AppendEntries(term=1, prevIndex=3, prevTerm=1, 1 entry, commitIndex=4)
n2 -> n1: AppendResponse(success=True, maxIndex=4)
n3 -> n1: AppendResponse(success=True, maxIndex=4)
note right of n2: Commit: index=4
note right of n3: Commit: index=4
n1 -> n2: AppendEntries(term=1, prevIndex=4, prevTerm=1, 1 entry, commitIndex=4)
note left of n1: Log: index=5, term=0
n1 -> n3: AppendEntries(term=1, prevIndex=4, prevTerm=1, 1 entry, commitIndex=4)
n1 -> n2: AppendEntries(term=1, prevIndex=4, prevTerm=1, 1 entry, commitIndex=4)
n1 -> n3: AppendEntries(term=1, prevIndex=4, prevTerm=1, 1 entry, commitIndex=4)
n2 -> n1: AppendResponse(success=True, maxIndex=4)
note right of n2: Log: index=5, term=0
n2 -> n1: AppendResponse(success=True, maxIndex=5)
n2 -> n1: AppendResponse(success=True, maxIndex=5)
n3 -> n1: AppendResponse(success=True, maxIndex=4)
note right of n3: Log: index=5, term=0
n3 -> n1: AppendResponse(success=True, maxIndex=5)
n3 -> n1: AppendResponse(success=True, maxIndex=5)
n1 -> n2: AppendEntries(term=1, prevIndex=4, prevTerm=1, 1 entry, commitIndex=4)
note left of n1: Commit: index=5
n1 -> n3: AppendEntries(term=1, prevIndex=4, prevTerm=1, 1 entry, commitIndex=5)
n2 -> n1: AppendResponse(success=True, maxIndex=5)
n3 -> n1: AppendResponse(success=True, maxIndex=5)
note right of n2: Commit: index=5
note right of n3: Commit: index=5
n1 -> n2: AppendEntries(term=1, prevIndex=5, prevTerm=1, 1 entry, commitIndex=5)
note left of n1: Log: index=6, term=0
n1 -> n3: AppendEntries(term=1, prevIndex=5, prevTerm=1, 1 entry, commitIndex=5)
n1 -> n2: AppendEntries(term=1, prevIndex=5, prevTerm=1, 1 entry, commitIndex=5)
n1 -> n3: AppendEntries(term=1, prevIndex=5, prevTerm=1, 1 entry, commitIndex=5)
n2 -> n1: AppendResponse(success=True, maxIndex=5)
note right of n2: Log: index=6, term=0
n2 -> n1: AppendResponse(success=True, maxIndex=6)
n2 -> n1: AppendResponse(success=True, maxIndex=6)
n3 -> n1: AppendResponse(success=True, maxIndex=5)
note right of n3: Log: index=6, term=0
n3 -> n1: AppendResponse(success=True, maxIndex=6)
n3 -> n1: AppendResponse(success=True, maxIndex=6)
n1 -> n2: AppendEntries(term=1, prevIndex=5, prevTerm=1, 1 entry, commitIndex=5)
note left of n1: Commit: index=6
n1 -> n3: AppendEntries(term=1, prevIndex=5, prevTerm=1, 1 entry, commitIndex=6)
n2 -> n1: AppendResponse(success=True, maxIndex=6)
n3 -> n1: AppendResponse(success=True, maxIndex=6)
note right of n2: Commit: index=6
note right of n3: Commit: index=6
n1 -> n2: AppendEntries(term=1, prevIndex=6, prevTerm=1, 1 entry, commitIndex=6)
note left of n1: Log: index=7, term=0
n1 -> n3: AppendEntries(term=1, prevIndex=6, prevTerm=1, 1 entry, commitIndex=6)
n1 -> n2: AppendEntries(term=1, prevIndex=6, prevTerm=1, 1 entry, commitIndex=6)
n1 -> n3: AppendEntries(term=1, prevIndex=6, prevTerm=1, 1 entry, commitIndex=6)
n2 -> n1: AppendResponse(success=True, maxIndex=6)
note right of n2: Log: index=7, term=0
n2 -> n1: AppendResponse(success=True, maxIndex=7)
n2 -> n1: AppendResponse(success=True, maxIndex=7)
n3 -> n1: AppendResponse(success=True, maxIndex=6)
note right of n3: Log: index=7, term=0
n3 -> n1: AppendResponse(success=True, maxIndex=7)
n3 -> n1: AppendResponse(success=True, maxIndex=7)
n1 -> n2: AppendEntries(term=1, prevIndex=6, prevTerm=1, 1 entry, commitIndex=6)
note left of n1: Commit: index=7
n1 -> n3: AppendEntries(term=1, prevIndex=6, prevTerm=1, 1 entry, commitIndex=7)
n2 -> n1: AppendResponse(success=True, maxIndex=7)
n3 -> n1: AppendResponse(success=True, maxIndex=7)
note right of n2: Commit: index=7
note right of n3: Commit: index=7
n1 -> n2: AppendEntries(term=1, prevIndex=7, prevTerm=1, 1 entry, commitIndex=7)
note left of n1: Log: index=8, term=0
n1 -> n3: AppendEntries(term=1, prevIndex=7, prevTerm=1, 1 entry, commitIndex=7)
n1 -> n2: AppendEntries(term=1, prevIndex=7, prevTerm=1, 1 entry, commitIndex=7)
n1 -> n3: AppendEntries(term=1, prevIndex=7, prevTerm=1, 1 entry, commitIndex=7)
n2 -> n1: AppendResponse(success=True, maxIndex=7)
note right of n2: Log: index=8, term=0
n2 -> n1: AppendResponse(success=True, maxIndex=8)
n2 -> n1: AppendResponse(success=True, maxIndex=8)
n3 -> n1: AppendResponse(success=True, maxIndex=7)
note right of n3: Log: index=8, term=0
n3 -> n1: AppendResponse(success=True, maxIndex=8)
n3 -> n1: AppendResponse(success=True, maxIndex=8)
n1 -> n2: AppendEntries(term=1, prevIndex=7, prevTerm=1, 1 entry, commitIndex=7)
note left of n1: Commit: index=8
n1 -> n3: AppendEntries(term=1, prevIndex=7, prevTerm=1, 1 entry, commitIndex=8)
n2 -> n1: AppendResponse(success=True, maxIndex=8)
n3 -> n1: AppendResponse(success=True, maxIndex=8)
note right of n2: Commit: index=8
note right of n3: Commit: index=8
n1 -> n2: AppendEntries(term=1, prevIndex=8, prevTerm=1, 1 entry, commitIndex=8)
note left of n1: Log: index=9, term=0
n1 -> n3: AppendEntries(term=1, prevIndex=8, prevTerm=1, 1 entry, commitIndex=8)
n1 -> n2: AppendEntries(term=1, prevIndex=8, prevTerm=1, 1 entry, commitIndex=8)
n1 -> n3: AppendEntries(term=1, prevIndex=8, prevTerm=1, 1 entry, commitIndex=8)
n2 -> n1: AppendResponse(success=True, maxIndex=8)
note right of n2: Log: index=9, term=0
n2 -> n1: AppendResponse(success=True, maxIndex=9)
n2 -> n1: AppendResponse(success=True, maxIndex=9)
n3 -> n1: AppendResponse(success=True, maxIndex=8)
note right of n3: Log: index=9, term=0
n3 -> n1: AppendResponse(success=True, maxIndex=9)
n3 -> n1: AppendResponse(success=True, maxIndex=9)
n1 -> n2: AppendEntries(term=1, prevIndex=8, prevTerm=1, 1 entry, commitIndex=8)
note left of n1: Commit: index=9
n1 -> n3: AppendEntries(term=1, prevIndex=8, prevTerm=1, 1 entry, commitIndex=9)
n2 -> n1: AppendResponse(success=True, maxIndex=9)
n3 -> n1: AppendResponse(success=True, maxIndex=9)
note right of n2: Commit: index=9
note right of n3: Commit: index=9
n1 -> n2: AppendEntries(term=1, prevIndex=9, prevTerm=1, 1 entry, commitIndex=9)
note left of n1: Log: index=10, term=0
n1 -> n3: AppendEntries(term=1, prevIndex=9, prevTerm=1, 1 entry, commitIndex=9)
n1 -> n2: AppendEntries(term=1, prevIndex=9, prevTerm=1, 1 entry, commitIndex=9)
n1 -> n3: AppendEntries(term=1, prevIndex=9, prevTerm=1, 1 entry, commitIndex=9)
n2 -> n1: AppendResponse(success=True, maxIndex=9)
note right of n2: Log: index=10, term=0
n2 -> n1: AppendResponse(success=True, maxIndex=10)
n2 -> n1: AppendResponse(success=True, maxIndex=10)
n3 -> n1: AppendResponse(success=True, maxIndex=9)
note right of n3: Log: index=10, term=0
n3 -> n1: AppendResponse(success=True, maxIndex=10)
n3 -> n1: AppendResponse(success=True, maxIndex=10)
n1 -> n2: AppendEntries(term=1, prevIndex=9, prevTerm=1, 1 entry, commitIndex=9)
note left of n1: Commit: index=10
n1 -> n3: AppendEntries(term=1, prevIndex=9, prevTerm=1, 1 entry, commitIndex=10)
n2 -> n1: AppendResponse(success=True, maxIndex=10)
n3 -> n1: AppendResponse(success=True, maxIndex=10)
note right of n2: Commit: index=10
note right of n3: Commit: index=10
n1 -> n2: AppendEntries(term=1, prevIndex=10, prevTerm=1, 1 entry, commitIndex=10)
note left of n1: Log: index=11, term=0
n1 -> n3: AppendEntries(term=1, prevIndex=10, prevTerm=1, 1 entry, commitIndex=10)
n1 -> n2: AppendEntries(term=1, prevIndex=10, prevTerm=1, 1 entry, commitIndex=10)
n1 -> n3: AppendEntries(term=1, prevIndex=10, prevTerm=1, 1 entry, commitIndex=10)
n2 -> n1: AppendResponse(success=True, maxIndex=10)
note right of n2: Log: index=11, term=0
n2 -> n1: AppendResponse(success=True, maxIndex=11)
n2 -> n1: AppendResponse(success=True, maxIndex=11)
n3 -> n1: AppendResponse(success=True, maxIndex=10)
note right of n3: Log: index=11, term=0
n3 -> n1: AppendResponse(success=True, maxIndex=11)
n3 -> n1: AppendResponse(success=True, maxIndex=11)
n1 -> n2: AppendEntries(term=1, prevIndex=10, prevTerm=1, 1 entry, commitIndex=10)
note left of n1: Commit: index=11
n1 -> n3: AppendEntries(term=1, prevIndex=10, prevTerm=1, 1 entry, commitIndex=11)
n2 -> n1: AppendResponse(success=True, maxIndex=11)
n3 -> n1: AppendResponse(success=True, maxIndex=11)
note right of n2: Commit: index=11
note right of n3: Commit: index=11
n1 -> n2: AppendEntries(term=1, prevIndex=11, prevTerm=1, 1 entry, commitIndex=11)
note left of n1: Log: index=12, term=0
n1 -> n3: AppendEntries(term=1, prevIndex=11, prevTerm=1, 1 entry, commitIndex=11)
n1 -> n2: AppendEntries(term=1, prevIndex=11, prevTerm=1, 1 entry, commitIndex=11)
n1 -> n3: AppendEntries(term=1, prevIndex=11, prevTerm=1, 1 entry, commitIndex=11)
n2 -> n1: AppendResponse(success=True, maxIndex=11)
note right of n2: Log: index=12, term=0
n2 -> n1: AppendResponse(success=True, maxIndex=12)
n2 -> n1: AppendResponse(success=True, maxIndex=12)
n3 -> n1: AppendResponse(success=True, maxIndex=11)
note right of n3: Log: index=12, term=0
n3 -> n1: AppendResponse(success=True, maxIndex=12)
n3 -> n1: AppendResponse(success=True, maxIndex=12)
n1 -> n2: AppendEntries(term=1, prevIndex=11, prevTerm=1, 1 entry, commitIndex=11)
note left of n1: Commit: index=12
n1 -> n3: AppendEntries(term=1, prevIndex=11, prevTerm=1, 1 entry, commitIndex=12)
n2 -> n1: AppendResponse(success=True, maxIndex=12)
n3 -> n1: AppendResponse(success=True, maxIndex=12)
note right of n2: Commit: index=12
note right of n3: Commit: index=12
n1 -> n2: AppendEntries(term=1, prevIndex=12, prevTerm=1, 1 entry, commitIndex=12)
note left of n1: Log: index=13, term=0
n1 -> n3: AppendEntries(term=1, prevIndex=12, prevTerm=1, 1 entry, commitIndex=12)
n1 -> n2: AppendEntries(term=1, prevIndex=12, prevTerm=1, 1 entry, commitIndex=12)
n1 -> n3: AppendEntries(term=1, prevIndex=12, prevTerm=1, 1 entry, commitIndex=12)
n2 -> n1: AppendResponse(success=True, maxIndex=12)
note right of n2: Log: index=13, term=0
n2 -> n1: AppendResponse(success=True, maxIndex=13)
n2 -> n1: AppendResponse(success=True, maxIndex=13)
n3 -> n1: AppendResponse(success=True, maxIndex=12)
note right of n3: Log: index=13, term=0
n3 -> n1: AppendResponse(success=True, maxIndex=13)
n3 -> n1: AppendResponse(success=True, maxIndex=13)
n1 -> n2: AppendEntries(term=1, prevIndex=12, prevTerm=1, 1 entry, commitIndex=12)
note left of n1: Commit: index=13
n1 -> n3: AppendEntries(term=1, prevIndex=12, prevTerm=1, 1 entry, commitIndex=13)
n2 -> n1: AppendResponse(success=True, maxIndex=13)
n3 -> n1: AppendResponse(success=True, maxIndex=13)
note right of n2: Commit: index=13
note right of n3: Commit: index=13
n1 -> n2: AppendEntries(term=1, prevIndex=13, prevTerm=1, 1 entry, commitIndex=13)
note left of n1: Log: index=14, term=0
n1 -> n3: AppendEntries(term=1, prevIndex=13, prevTerm=1, 1 entry, commitIndex=13)
n1 -> n2: AppendEntries(term=1, prevIndex=13, prevTerm=1, 1 entry, commitIndex=13)
n1 -> n3: AppendEntries(term=1, prevIndex=13, prevTerm=1, 1 entry, commitIndex=13)
n2 -> n1: AppendResponse(success=True, maxIndex=13)
note right of n2: Log: index=14, term=0
n2 -> n1: AppendResponse(success=True, maxIndex=14)
n2 -> n1: AppendResponse(success=True, maxIndex=14)
n3 -> n1: AppendResponse(success=True, maxIndex=13)
note right of n3: Log: index=14, term=0
n3 -> n1: AppendResponse(success=True, maxIndex=14)
n3 -> n1: AppendResponse(success=True, maxIndex=14)
n1 -> n2: AppendEntries(term=1, prevIndex=13, prevTerm=1, 1 entry, commitIndex=13)
note left of n1: Commit: index=14
n1 -> n3: AppendEntries(term=1, prevIndex=13, prevTerm=1, 1 entry, commitIndex=14)
n2 -> n1: AppendResponse(success=True, maxIndex=14)
n3 -> n1: AppendResponse(success=True, maxIndex=14)
note right of n2: Commit: index=14
note right of n3: Commit: index=14
n1 -> n2: AppendEntries(term=1, prevIndex=14, prevTerm=1, 1 entry, commitIndex=14)
note left of n1: Log: index=15, term=0
n1 -> n3: AppendEntries(term=1, prevIndex=14, prevTerm=1, 1 entry, commitIndex=14)
n1 -> n2: AppendEntries(term=1, prevIndex=14, prevTerm=1, 1 entry, commitIndex=14)
n1 -> n3: AppendEntries(term=1, prevIndex=14, prevTerm=1, 1 entry, commitIndex=14)
n2 -> n1: AppendResponse(success=True, maxIndex=14)
note right of n2: Log: index=15, term=0
n2 -> n1: AppendResponse(success=True, maxIndex=15)
n2 -> n1: AppendResponse(success=True, maxIndex=15)
n3 -> n1: AppendResponse(success=True, maxIndex=14)
note right of n3: Log: index=15, term=0
n3 -> n1: AppendResponse(success=True, maxIndex=15)
n3 -> n1: AppendResponse(success=True, maxIndex=15)
n1 -> n2: AppendEntries(term=1, prevIndex=14, prevTerm=1, 1 entry, commitIndex=14)
note left of n1: Commit: index=15
n1 -> n3: AppendEntries(term=1, prevIndex=14, prevTerm=1, 1 entry, commitIndex=15)
n2 -> n1: AppendResponse(success=True, maxIndex=15)
n3 -> n1: AppendResponse(success=True, maxIndex=15)
note right of n2: Commit: index=15
note right of n3: Commit: index=15
n1 -> n2: AppendEntries(term=1, prevIndex=15, prevTerm=1, 1 entry, commitIndex=15)
note left of n1: Log: index=16, term=0
n1 -> n3: AppendEntries(term=1, prevIndex=15, prevTerm=1, 1 entry, commitIndex=15)
n1 -> n2: AppendEntries(term=1, prevIndex=15, prevTerm=1, 1 entry, commitIndex=15)
n1 -> n3: AppendEntries(term=1, prevIndex=15, prevTerm=1, 1 entry, commitIndex=15)
n2 -> n1: AppendResponse(success=True, maxIndex=15)
note right of n2: Log: index=16, term=0
n2 -> n1: AppendResponse(success=True, maxIndex=16)
n2 -> n1: AppendResponse(success=True, maxIndex=16)
n3 -> n1: AppendResponse(success=True, maxIndex=15)
note right of n3: Log: index=16, term=0
n3 -> n1: AppendResponse(success=True, maxIndex=16)
n3 -> n1: AppendResponse(success=True, maxIndex=16)
n1 -> n2: AppendEntries(term=1, prevIndex=15, prevTerm=1, 1 entry, commitIndex=15)
note left of n1: Commit: index=16
n1 -> n3: AppendEntries(term=1, prevIndex=15, prevTerm=1, 1 entry, commitIndex=16)
n2 -> n1: AppendResponse(success=True, maxIndex=16)
n3 -> n1: AppendResponse(success=True, maxIndex=16)
note right of n2: Commit: index=16
note right of n3: Commit: index=16

legend right
  <#GhostWhite,#GhostWhite>|      |= __Legend__ |
  |<#Lightgreen>| Raft Node |
  |FOLLOWER| Follower Role |
  |CANDIDATE| Candidate Role |
  |LEADER| Leader Role |
endlegend
@enduml
